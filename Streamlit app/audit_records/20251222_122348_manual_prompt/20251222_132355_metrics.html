<!DOCTYPE html>
<html>
<head>
    <title>Metrics Report</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 0; padding: 20px; background: #f5f5f5; }
        .container { max-width: 1200px; margin: 0 auto; background: white; padding: 30px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        h1 { color: #2c3e50; border-bottom: 3px solid #3498db; padding-bottom: 10px; }
        h2 { color: #34495e; margin-top: 30px; }
        .chart-container { margin: 30px 0; padding: 20px; background: #fafafa; border-radius: 8px; position: relative; width: 100%; height: 400px; }
        .metric-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin: 20px 0; }
        .metric-card { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; border-radius: 10px; text-align: center; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .metric-card h3 { margin: 0 0 10px 0; font-size: 14px; opacity: 0.9; }
        .metric-card .value { font-size: 36px; font-weight: bold; margin: 10px 0; }
        .metric-card.success { background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%); }
        .metric-card.warning { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); }
        .metric-card.info { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); }
        canvas { max-height: 350px !important; }
        .timestamp { color: #7f8c8d; font-size: 14px; margin-top: 10px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ðŸ“Š Vulnerability Analysis Metrics</h1>
        <p class="timestamp">Generated: 2025-12-22 13:24:18</p>
        
        <h2>Key Performance Indicators</h2>
        <p style="color: #7f8c8d; font-size: 14px; margin-bottom: 20px;">
            <strong>Note:</strong> Metrics combine results from Custom Detector, Bandit, and Semgrep.<br>
            <strong>Fix Rate vs Effectiveness:</strong> Fix Rate shows the percentage of vulnerabilities fixed. 
            Effectiveness Score adjusts this by penalizing if new vulnerabilities were introduced during patching 
            (reduces by 10% per new vulnerability). When both rates are equal, no new issues were introduced.
        </p>
        <div class="metric-grid">
            <div class="metric-card success">
                <h3>Total Vulnerabilities Detected</h3>
                <div class="value">2</div>
                <p>All Occurrences Found</p>
            </div>
            <div class="metric-card">
                <h3>Total Remaining</h3>
                <div class="value">0</div>
                <p>All Tools Combined</p>
            </div>
            <div class="metric-card success">
                <h3>Total Fixed</h3>
                <div class="value">2</div>
                <p>Issues Resolved</p>
            </div>
            <div class="metric-card info">
                <h3>Fix Rate</h3>
                <div class="value">100.0%</div>
                <p>Overall Effectiveness</p>
            </div>
        </div>
        
        <h2>Tool Breakdown</h2>
        <div class="metric-grid">
            <div class="metric-card">
                <h3>Custom Detector</h3>
                <div class="value">2</div>
                <p>Total Custom Detector Found</p>
            </div>
            <div class="metric-card">
                <h3>Bandit</h3>
                <div class="value">0</div>
                <p>Total Bandit Found</p>
            </div>
            <div class="metric-card">
                <h3>Semgrep</h3>
                <div class="value">0</div>
                <p>Total Semgrep Found</p>
            </div>
            <div class="metric-card info">
                <h3>Effectiveness</h3>
                <div class="value">100.0%</div>
                <p>Quality Score</p>
            </div>
        </div>
        
        <h2>Severity Distribution</h2>
        <p style="color: #7f8c8d; margin: 10px 0 20px 0; font-size: 14px;">
            <strong>Total Detected:</strong> All vulnerabilities found across all phases (initial + iterations)<br>
            <strong>Remaining Unfixed:</strong> Vulnerabilities still present after all patching attempts (shows 0 if code is fully patched)
        </p>
        <div class="chart-container">
            <canvas id="severityChart"></canvas>
        </div>
        
        <h2>Tool Detection Comparison</h2>
        <div class="chart-container">
            <canvas id="toolChart"></canvas>
        </div>
        
        <h2>Patching Effectiveness Breakdown</h2>
        <div class="chart-container">
            <canvas id="patchingChart"></canvas>
        </div>
    </div>
    
    <script>
        console.log('Starting chart initialization...');
        
        // Severity Distribution Chart
        try {
            const severityCtx = document.getElementById('severityChart').getContext('2d');
            console.log('Severity chart data:', {
                high: [1, 0],
                medium: [0, 0],
                low: [1, 0]
            });
            new Chart(severityCtx, {
                type: 'bar',
                data: {
                    labels: ['Total Detected', 'Remaining Unfixed'],
                    datasets: [
                        {
                            label: 'High Severity',
                            data: [1, 0],
                            backgroundColor: '#e74c3c'
                        },
                        {
                            label: 'Medium Severity',
                            data: [0, 0],
                            backgroundColor: '#f39c12'
                        },
                        {
                            label: 'Low Severity',
                            data: [1, 0],
                            backgroundColor: '#2ecc71'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: { display: true, text: 'Vulnerability Severity: All Detected vs. Remaining Unfixed' },
                        legend: { position: 'top' }
                    },
                    scales: {
                        y: { beginAtZero: true, title: { display: true, text: 'Count' } }
                    }
                }
            });
            console.log('Severity chart created successfully');
        } catch (e) {
            console.error('Severity chart error:', e);
        }
        
        // Tool Comparison Chart
        try {
            const toolCtx = document.getElementById('toolChart').getContext('2d');
            console.log('Tool chart data:', [2, 0, 0]);
            new Chart(toolCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Custom Detector', 'Bandit', 'Semgrep'],
                    datasets: [{
                        data: [2, 0, 0],
                        backgroundColor: ['#3498db', '#9b59b6', '#e67e22']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: { display: true, text: 'Vulnerabilities Detected by Each Tool (All Phases)' },
                        legend: { position: 'right' }
                    }
                }
            });
            console.log('Tool chart created successfully');
        } catch (e) {
            console.error('Tool chart error:', e);
        }
        
        // Patching Effectiveness Chart
        try {
            const patchCtx = document.getElementById('patchingChart').getContext('2d');
            console.log('Patch chart data:', [2, 0]);
            new Chart(patchCtx, {
                type: 'pie',
                data: {
                    labels: ['Fixed', 'Remaining'],
                    datasets: [{
                        data: [2, 0],
                        backgroundColor: ['#27ae60', '#e74c3c']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: { display: true, text: 'Vulnerabilities Fixed vs Remaining' },
                        legend: { position: 'bottom' }
                    }
                }
            });
            console.log('Patch chart created successfully');
        } catch (e) {
            console.error('Patch chart error:', e);
        }
        
        console.log('All charts initialized');
    </script>
</body>
</html>
